\documentclass[12pt]{article}

\newif\ifsol
\soltrue

\include{macros}

\begin{document}
\begin{center}
\Large{\textbf{CAS CS 538.  \ifsol Solutions to \fi Problem Set 5}}\\
\smallskip
\large{\textbf{Due electronically via gradescope, \textcolor{red}{Tuesday February 24}, 2026 11:59pm}}\\
\large{\textbf{Om Khadka, U51801771}}
\end{center}

\noindent

\begin{problem} (50 points)

\noindent In Discussion 5 we introduced the Signal symmetric ratchet and we showed that even if a subsequent key is leaked to the adversary, it is hard to recover the previous key. 
In this problem, we will prove something stronger: even if a subseuqent key is leaked (and the previous key has been deleted), past encryptions are still semantically secure.

Specifically, let $\E = (\Enc, \Dec)$ be a semantically secure cipher over $(\K, \M, \C)$. 
Let $G : \S \to \S \times \K$ be a secure PRG such that $G: \left\{0,1 \right\}^\ell \to \left\{0,1 \right\}^{2\ell}$. 
Define the symmetric ratchet scheme as $\Enc^1(s, m) = \Enc(G(s)_2, m)$ and $\Dec^1(s,c) = \Dec(G(s)_2, c)$. 
Here $G(s)_2$ denotes the second part of the output of $G(s)$, i.e. the key part. 
We refer you to Figure 1 of Discussion 5 for a diagram of the symmetric ratchet.

At time step $n$, participants will advance the state of the ratchet by computing $(s_n, k_n) \gets G(s_{n-1})$.
Then, the past is erased by deleting the old seed $s_{n-1}$ from memory.
The new ciphertext is computed as $c_n = \Enc(k_n, m_n)$.
 
Prove that $\E^1$ is {\it semantically secure} for the previous encryption $c_{n-1}$ even if a subsequent seed and key $(s_n, k_n)$ is leaked to the adversary.


\paragraph{Getting started.}
To get started, you should consider an adversary $\Adv$ playing a new game called the $\SSkeyleak$ game against $\E^1$.
The $\SSkeyleak$ is the same as the Semantic Security Game (Boneh + Shoup Attack Game 2.1) except that in addition to a ciphertext $c_{n-1}$, the adversary {\it also} receives a leaked seed and key $(s_n, k_n)$ where $s_n,k_n$ are pseudorandom values produced by $G^n$ with an initial random seed.

In particular, say $\Adv$ outputs two messages $m_0, m_1$.
Let Game $0$ be when $c_{n-1}=\Enc^1(k_{n-1}, m_0)$ and Game 1 be when $c_{n-1}=\Enc(k_{n-1}, m_1)$.
$\Adv$ receives the tuple $(c_{n-1}, s_n, k_n)$ and outputs a bit $\hat{b}$.
Let $W_b$ be the event that $\hat{b} = 1$ in Game $b$ of the $\SSkeyleak$ game. 
Then we define the key-leakage advantage as $\SSkeyleakadv[\Adv, \E^1] = |\Pr[W_0] - \Pr[W_1]|$.  


\paragraph{Building a hybrid argument.}
Use a hybrid argument to prove that $\E^1$ is semantically secure against leaked keys by showing that $\SSkeyleakadv[\Adv, \E^1]$ is negligible. 

\emph{Hint: you will have to introduce two hybrid games in between Game 0 and Game 1 of $\SSkeyleak$ game. Then you will give three reductions with wrapper adversaries $\B_1$, $\B_2$, and $\B_3$. In no particular order, two of these reductions yield a PRG distinguisher for $G^n$ and one of them yields an SS adversary for $\E$.}

\end{problem}

\begin{solution}
The whole idea behind how I'll prove this by essentially splitting up the whole process into a bunch of hybrid arguments, and showing how the sum of all of the reductions end up being negligible.
\\
\\
Let $G^n: \{0, 1\}^\ell \to \{0, 1\}^{(n+1)\ell}$ be the $n$-wise sequential composition of $G$, outputting $(k_1, s_1, \dots, k_n, s_n)$. Also assume that $G$ is a secure PRG, thereby also meaning that $G^n$ is also secure.

\subsection*{The Hybrid Games}

\begin{description}
    \item[Game 0:] The initial real $\SSkeyleak$ game w/ bit $b=0$.
    \begin{enumerate}
        \item Challenger samples $s_0 \leftarrow \{0, 1\}^\ell$.
        \item Calculates $(k_1, s_1, \dots, k_n, s_n) \gets G^n(s_0)$.
        \item $\A$ then outputs $m_0, m_1$.
        \item Challenger computes $c_{n-1} = \Enc(k_{n-1}, m_0)$.
        \item Challenger then gives $(c_{n-1}, k_n, s_n)$ to $\A$.
        \item $\A$ returns $\hat{b}$.
    \end{enumerate}
    Let $\Pr[W_0]$ denote the probability of $\A$ outputting $1$.

    \item[Hybrid 1:] Same as Game 0, but but now the keys and seeds are replaced w/ rnd uniform values.
    \begin{enumerate}
        \item Challenger samples $(k_1, \dots, k_n, s_n) \leftarrow \{0, 1\}^{(n+1)\ell}$ uniformly at random.
        \item $\A$ outputs $m_0, m_1$.
        \item Challenger then Computes $c_{n-1} = \Enc(k_{n-1}, m_0)$.
        \item Challenger will then give $(c_{n-1}, k_n, s_n)$ to $\A$.
        \item $\A$ finlly returns $\hat{b}$.
    \end{enumerate}
    $\Pr[H_1]$ will be the probability of $\A$ outputting $1$.

    \item[Hybrid 2:] Hybrid 1, but now the msg is $m_1$.
    \begin{enumerate}
        \item Challenger samples $(k_1, \dots, k_n, s_n) \leftarrow \{0, 1\}^{(n+1)\ell}$ uniformly at random.
        \item $\A$ outputs $m_0, m_1$.
        \item Challenger calcualtes $c_{n-1} = \Enc(k_{n-1}, m_1)$.
        \item Challenger then gives $(c_{n-1}, k_n, s_n)$ to $\A$.
        \item $\A$ returns $\hat{b}$.
    \end{enumerate}
    Let $\Pr[H_2]$ be the chance of $\A$ outputting $1$.

    \item[Game 1:] Finally circling back to the $\SSkeyleak$ game, but now w/ bit $b=1$.
    \begin{enumerate}
        \item Challenger samples $s_0 \leftarrow \{0, 1\}^\ell$.
        \item Compute $(k_1, s_1, \dots, k_n, s_n) \gets G^n(s_0)$.
        \item $\A$ outputs $m_0, m_1$.
        \item Challenger then calculates $c_{n-1} = \Enc(k_{n-1}, m_1)$.
        \item Give that value, $(c_{n-1}, k_n, s_n)$, to $\A$.
        \item $\A$ returns $\hat{b}$.
    \end{enumerate}
    Let $\Pr[W_1]$ be the probability of $\A$ outputting $1$.
\end{description}

By the triangle inequality, the advantage is then bounded by the following expression:
\begin{equation}
    \left| \Pr[W_0] - \Pr[W_1] \right| \leq \left| \Pr[W_0] - \Pr[H_1] \right| + \left| \Pr[H_1] - \Pr[H_2] \right| + \left| \Pr[H_2] - \Pr[W_1] \right|.
\end{equation}

\subsection*{Reducing and Analyzing}

\paragraph{Game 0 $\to$ Game $H_1$}
Let $\B_1$ be a new adversay against $G^n$.
\begin{itemize}
    \item $\B_1$ will recieve a challenge string $r \in \{0, 1\}^{(n+1)\ell}$ from $G^n$.
    \item $\B_1$ will then parse $r$ as $(k_1, \dots, k_n, s_n)$.
    \item $\B_1$ will run $\A$ to get $m_0, m_1$.
    \item $\B_1$ then computs $c_{n-1} = \Enc(k_{n-1}, m_0)$.
    \item Finally, $\B_1$ gives $(c_{n-1}, k_n, s_n)$ to $\A$ and its response.
\end{itemize}
Analyzing this:
\begin{itemize}
    \item If $r$ is outputted by $G^n(s_0)$, then this is just \textbf{Game 0}. So then $\Pr[\B_1 \to 1 \mid \text{Real}] = \Pr[W_0]$.
    \item In the same manner, if $r$ is uniform random, then this is just \textbf{Hybrid 1}. Thus, $\Pr[\B_1 \to 1 \mid \text{Random}] = \Pr[H_1]$.
\end{itemize}
$|\Pr[W_0] - \Pr[H_1]| = \PRGadv[\B_1, G^n]$, which is negligible.

\paragraph{Game $H_1$ $\to$ Game $H_2$}
$\B_2$ will now be the adversay against the semantic security of $\E$.
\begin{itemize}
    \item $\B_2$ will run $\A$ to get $m_0, m_1$.
    \item $\B_2$ then sends $m_0, m_1$ to the SS challenger for $\E$.
    \item $\B_2$ will then get a ciphertext, $c^*$, from the challenger (which is just $\Enc(k^*, m_b)$ for a rnd key $k^*$).
    \item $\B_2$ then samples $(k_n, s_n) \leftarrow \{0, 1\}^{2\ell}$ uniformly at random.
    \item And then $\B_2$ will give $(c^*, k_n, s_n)$ to $\A$, and output its response.
\end{itemize}
Looking at this:
\begin{itemize}
    \item The key for the SS game, $c^*$, is rnd and independant of the leak. This is also the same distribution as $k_{n-1}$ back in \textbf{Hybrid 1} and \textbf{Hybrid 2}.
    \item So then, if the SS challenger chooses $m_0$, then this is just \textbf{Hybrid 1}.
    \item If instead the SS challenger chooses $m_1$, then it is just \textbf{Hybrid 2}.
\end{itemize}
$|\Pr[H_1] - \Pr[H_2]| = \SSadv[\B_2, \E]$, which is negligible.

\paragraph{Game $H_2$ $\to$ Game 1}
$\B_3$ will now be challenging the PRG security of $G^n$.
\begin{itemize}
    \item $\B_3$ gets a challenge string $r \in \{0, 1\}^{(n+1)\ell}$ from $G^n$.
    \item $\B_3$ will parse $r$ as $(k_1, \dots, k_n, s_n)$.
    \item $\B_3$ then runs $\A$ to gets $m_0, m_1$.
    \item $\B_3$ computes $c_{n-1} = \Enc(k_{n-1}, m_1)$.
    \item And finally, $\B_3$ gives $(c_{n-1}, k_n, s_n)$ to $\A$ and outputs its response.
\end{itemize}
Looking at this game:
\begin{itemize}
    \item If $r$ is outputted by $G^n(s_0)$, then this is just \textbf{Game 1}. This basically means that $\Pr[\B_3 \to 1 \mid \text{Real}] = \Pr[W_1]$.
    \item If instead $r$ is uniform random, then this is just \textbf{Hybrid 2}, meaning that $\Pr[\B_3 \to 1 \mid \text{Random}] = \Pr[H_2]$.
\end{itemize}
$|\Pr[H_2] - \Pr[W_1]| = \PRGadv[\B_3, G^n]$, which is negligible.

\subsection*{End}

Combining the bounds, we get:
\begin{equation}
    \SSkeyleakadv[\A, \E^1] \leq \PRGadv[\B_1, G^n] + \SSadv[\B_2, \E] + \PRGadv[\B_3, G^n].
\end{equation}
I've already assumed, in the beginning, that $G^n$ was secure, making the PRG advantages negligible. Also, since $\E$ is semantically secure, then that also means that SS advantage is negligible. And since the sum of negligibles is negligble too, then $\therefore \SSkeyleakadv[\A, \E^1]$ is negligible.
\end{solution}

\newpage

\begin{problem} (50 points at 10 each)
  Let $p > 2$ be an odd prime.
For this problem, suppose the order of $g$ is $p-1$ (which is even). Such a $g$ is called a \emph{generator} of $\Z_p^*$. Such a $g$ exists for every $p$ (we won't prove this fact; see, for example, Section 7.5 of Victor Shoup's book at \url{http://www.shoup.net/ntb/ntb-v2.pdf} for the existence proof and Section 11.1 for how to sample it efficiently).

\begin{ppart}
Let $a = g^x$ for some $x \in \Z_{p - 1}$ (the exponent works modulo $p - 1$ due to Fermat's little theorem).
We can talk about the exponent $x$ being even since $p - 1$ is even, and therefore $x + k(p - 1)$ has the same evenness as $x$ for any $k \in \Z$.

Clearly if $x$ is even, then
$a$ has a square root $g^{x/2}$ modulo $p$.  Now show the converse: if $a$ has
a square root modulo $p$, then $x$ is even. \textit{(Hint: you can rewrite any element $b\in \mathbb{Z}_p^\ast$ as $b=g^y$ for some $y \in \mathbb{Z}_{p-1}$.)}\end{ppart}

\begin{solution}
I can't really explain the way I'll solve this proof without just restating the proof, but I will say that this soltuion basically involves just doing a bunch of substitution, "technically".\\\\

\noindent Firstly, assume that $a$ has a sqrt modulo $p$. Now let $r \in \Z_p^*$ be such that $r^2 \equiv_p a$.\\

\noindent Since $g$ is a generator of $\Z_p^*$, then every element in $\Z_p^*$ can be represented as a power of $g$. Therefore, there exists some $y \in \Z_{p-1}$ such that $r = g^y$.\\

\noindent Substituting this into the square root equation:
\begin{equation}
a \equiv_p r^2 \equiv_p (g^y)^2 \equiv_p g^{2y}.
\end{equation}

\noindent Also, since we know that $a = g^x$, then that also means:
\begin{equation}
g^x \equiv_p g^{2y}.
\end{equation}

\noindent Since $g$ has multiplicative order $p-1$ in $\Z_p^*$, then we have:
\begin{equation}
x \equiv 2y \pmod{p-1}.
\end{equation}

\noindent This ultimately means that there exists some integer $k$ such that:
\begin{equation}
x = 2y + k(p-1).
\end{equation}

\noindent Now observe:
\begin{itemize}
\item $2y$ is even (it is a multiple of 2).
\item $p-1$ is even (since $p > 2$ is an odd prime).
\item Therefore $k(p-1)$ is even for any int $k$.
\end{itemize}

\noindent And since $x$ is the sum of two even numbers, $x$ must be even. QED.
\end{solution}

It'd be nice to check if a value is a square modulo $p$ without having to explicitly know what power of $g$ it is. Luckily we have the following test: $a$ is a square iff $a^{(p-1)/2} \equiv_p 1$.

\begin{ppart}
    Prove the forward direction: if $a$ is square then $a^{(p-1)/2} \equiv_p 1$.
\end{ppart}

\begin{solution}
Like again, these are one of those convoluted math-substitution problems, where I just gotta go back to rules to solve it. But I think this particular question does rely on Fermat's little theorem.\\

\noindent Being by assuming that $a$ is a square modulo $p$. Theb by its definition, there exists some $r \in \Z_p^*$ such that $r^2 \equiv_p a$.\\

\noindent Like I said before, every element can be written as a power of $g$. Thus, $\exists y \in \Z_{p-1}, r = g^y$.\\

\noindent Now by subbing this into the equation for $a$, we have:
\begin{equation}
a \equiv_p r^2 \equiv_p (g^y)^2 \equiv_p g^{2y}.
\end{equation}

\noindent Calcuating $a^{(p-1)/2}$:
\begin{equation}
a^{(p-1)/2} \equiv_p (g^{2y})^{(p-1)/2} \equiv_p g^{2y \cdot \frac{p-1}{2}} \equiv_p g^{y(p-1)}.
\end{equation}

\noindent And now, by Fermat's Little Theorem, since $g \in \Z_p^*$, then it must be the case that $g^{p-1} \equiv_p 1$. Therefore:
\begin{equation}
g^{y(p-1)} \equiv_p (g^{p-1})^y \equiv_p 1^y \equiv_p 1.
\end{equation}

\noindent Thus, I have shwon that if $a$ is a square, then $a^{(p-1)/2} \equiv_p 1$.
\end{solution}


\begin{ppart}
    Now prove the converse: if $a^{(p-1)/2} \equiv_p 1$, then $a$ is square. \textit{(Hint: Assume not and find a contradiction. Begin by writing $a$ as $g^x$.)}
\end{ppart}

\begin{solution}
Your solution goes here
\end{solution}


\noindent
We have thus shown that exactly half the values in $\Z_p^*$ have square
roots, and we know how to identify them: by raising to $(p-1)/2$.  Note
also that values that do have square roots have at least two of them: if $r \in \Z_p^*$
is a square root of $a \in \Z_p^*$, then so is $-r$, because $(-r)^2 = (-1)\cdot r\cdot(-1)\cdot r = (-1)(-1)r^2 = 1\cdot r^2 = r^2$.
The two square roots are different, because $p-r\neq r$ as $p$ is odd. Therefore, each square
cannot have more than two square roots by
a simple counting argument: if some square had more than two square roots, there wouldn't be enough square roots for all the $(p-1)/2$ squares, because just two square roots per square already takes up all the $p-1$ possible square root values in $\Z_p^*$. Thus, each square has exactly two square roots.


\begin{ppart}
Show that if $\left(g^x\right )^2\equiv_p a$, then $\left
(g^{x+(p-1)/2}\right)^2 \equiv_p a$, as well.  Show that these two square roots are distinct: that is, show that
$g^x\not \equiv_p g^{x+(p-1)/2}$.
\end{ppart}
\begin{solution}
Your solution goes here
\end{solution}

\noindent
We know from the paragraph above that $a$ has only two square roots. But we have three values that all when squared give us $a$: $g^x$, $g^{x+(p-1)/2}$,
and $-g^x$.  Thus, it must be that $g^{x+(p-1)/2}\equiv_p -g^x$.

\begin{ppart}
Given that $g^{x+(p-1)/2}\equiv_p -g^x$, show that 
that $g^{(p-1)/2}\equiv_p -1$. Now show that for any $b\in \Z_p^*$ that is a non-square,
$b^{(p-1)/2} \equiv_p -1$.
\end{ppart}

\noindent
This refines our previous test for squares from parts (b) and (c): to test if something
is a square, you raise it to $(p-1)/2$ modulo $p$ and check if the result is 1
or $-1$.  By the way, the value of $a^{(p-1)/2} \,\%\,p$ is called the Legendre symbol
of $a$ and is often written as $\left(\frac{a}{p}\right)$. The Legendre symbol can be generalized for composite $p$ and this generalization is called the Jacobi symbol (we will not cover it here).
\end{problem}

\begin{solution}
Your solution goes here
\end{solution}

\end{document}
